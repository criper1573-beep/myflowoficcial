# Исследование веб-интерфейса Яндекс.Дзен (ШАГ 1)

Полные ответы на вопросы из [UNIVERSAL_AUTOPOST_PROMPT](UNIVERSAL_AUTOPOST_PROMPT.md) — исследование через MCP browser tools и скрипт `research_zen_studio.py` с cookies.

---

## 1.1. Анализ страницы входа

### 1. Какой URL страницы входа/регистрации?

- **Яндекс (единая авторизация):**  
  `https://passport.yandex.ru/auth?retpath=https%3A%2F%2Fdzen.ru%2Fprofile%2Feditor%2Fflowcabinet`  
  (retpath — возврат после входа)

- **Прямой переход с dzen.ru:** при клике «Войти» на dzen.ru открывается модалка с полем телефона и ссылкой «Войти через Яндекс ID», ведущей на passport.yandex.ru

### 2. Какие поля на форме входа?

**Вариант 1 — телефон (по умолчанию):**
- `textbox` name: `phone`, value: `+7`, placeholder: `(000) 000-00-00`
- Кнопка «Log in» / «Продолжить»

**Вариант 2 — логин/пароль:**
- Меню «More» (Ещё) → «Log in with username»
- Поле 1: `textbox` name: `Username or email`, placeholder: `Username or email`
- Поле 2 (после ввода логина): пароль — `input[type="password"]`, `#passp-field-passwd`
- Кнопка «Log in»

**Селекторы (из zen_client.py):**
- Email: `#passp-field-login`, `input[name="login"]`, `input[type="email"]`
- Пароль: `#passp-field-passwd`, `input[name="passwd"]`, `input[type="password"]`
- Отправка: `button[type="submit"]`, `#passp:sign-in`

### 3. Есть ли двухфакторная аутентификация?

Возможна, если в аккаунте Яндекс включена 2FA. На экране логина явной 2FA по умолчанию не видно — срабатывает после успешного ввода пароля.

### 4. Есть ли CAPTCHA?

- **Да.** SmartCaptcha с текстом «Вы не робот» может появляться при автоматическом входе, особенно при частых запросах с одного IP.
- В `zen_client.py`: `_wait_captcha_if_present()` — при наличии капчи ожидание 90 секунд для ручного решения.

### 5. Какие cookies устанавливаются после входа?

Сессия хранится в `zen_storage_state.json` через Playwright `context.storage_state()`. Используются стандартные Яндекс-куки (Session_id, Session_id2, yandexuid и др.). Рекомендуется сохранять через `docs/scripts/scripts/capture_cookies.py`.

---

## 1.2. Анализ страницы создания поста

### 1. Какой URL страницы создания поста/статьи?

- **Студия (кабинет):**  
  `https://dzen.ru/profile/editor/flowcabinet` → редирект на `https://dzen.ru/flowcabinet`
- **Публикации:**  
  `https://dzen.ru/profile/editor/flowcabinet/publications`
- **Открытие редактора:** кнопка «+» в правом верхнем углу → «Написать статью» (или «Новая статья»). URL редактора может быть модальным или отдельной страницей (например, `.../editor` или `.../publications/new`).

### 2. Какие поля нужно заполнить?

- **Заголовок** — до 140 символов, без ссылок
- **Основной текст** — до 100 000 символов; форматирование: подзаголовки, цитаты, списки, жирный, курсив, ссылки
- **Обложка** — изображение (от 300px, до 30 МБ)
- **Теги** — для категоризации
- **Описание (excerpt)** — опционально

### 3. Какой редактор используется?

Из `zen_client.py` и PLAYWRIGHT_AUTOPOST:
- **contenteditable** — основное поле контента
- Поддерживаются селекторы: `.ql-editor` (Quill), `.ProseMirror` (ProseMirror)
- Судя по селекторам, возможны Quill или ProseMirror; на странице publications редактор не загружен — нужен переход в «Новая статья»/«Написать статью»

### 4. Есть ли скрытые поля (hidden inputs)?

Явно не обнаружены. Редактор — SPA, данные уходят через API. Скрытые поля при необходимости искать в DevTools на странице редактора.

### 5. Как сохраняется контент? (автосохранение, кнопка, AJAX)

- **Автосохранение** — вероятно (типично для Дзен-редактора)
- **Кнопки:** «Опубликовать», «Сохранить» / «Черновик»
- **Публикация:** через API (`context.request.post`), а не `fetch` со страницы (CORS)

### 6. Есть ли sidebar с настройками?

Да. На странице публикаций видна боковая панель (Главная, Статистика, Публикации, Комментарии, Монетизация, Донаты, Настройки и др.). В редакторе — панель инструментов и настройки публикации (обложка, дата, комментарии).

### 7. Как загружаются изображения/видео?

- **Изображения в статье:** добавьте пустую строку → слева появится иконка изображения → клик → загрузка по ссылке или с устройства
- **Обложка:** добавляется в модалке при нажатии «Опубликовать» — окно подготовки публикации, выбор картинки для обложки
- **input[type="file"]:** в редакторе и модалке может быть скрыт; в zen_client — `set_input_files()` или `expect_file_chooser()` при клике на «Добавить обложку»
- **Обложка по URL:** скачивание через httpx/requests во временный файл → загрузка через file input
- **Видео:** `input[type="file"][accept*="video"]`; поддерживаются YouTube, VK
- Ограничения: до 30 МБ на изображение, до 30 фото в галерее, до 100 вложений

---

## Модалки (закрывать до работы)

1. **«Яндекс станет основным поиском»** — `dismiss_yandex_default_search_modal()` из `playwright_helpers.py`
2. **«У нас появились донаты!»** — кнопка «Закрыть» / крестик или Escape; `data-testid="modal-overlay"` перекрывает клики

---

## Навигация к редактору

1. Перейти на `https://dzen.ru/profile/editor/flowcabinet` (с cookies)
2. Закрыть модалки (Escape, dismiss)
3. Либо перейти на `https://dzen.ru/profile/editor/flowcabinet/publications`
4. Нажать кнопку «+» (создание контента) в правом верхнем углу
5. Выбрать «Написать статью» / «Новая статья»
6. Откроется редактор (модалка или отдельная страница)

---

## Селекторы (из zen_client и исследования)

| Элемент          | Селектор |
|------------------|----------|
| Заголовок        | `[placeholder*="Заголовок"]`, `h1[contenteditable]`, `input[name="title"]` |
| Контент          | `.ql-editor`, `.ProseMirror`, `[contenteditable="true"]` |
| Теги             | `input[name="tags"]`, `input[placeholder*="тег"]` |
| Загрузка файла   | `input[type="file"]` |
| Опубликовать     | `button:has-text("Опубликовать")` |
| Черновик         | `button:has-text("Сохранить")`, `button:has-text("Черновик")` |
| Вход выполнен    | `button:has-text('Новая статья')`, `a:has-text('Новая статья')`, отсутствие «Войти» |
