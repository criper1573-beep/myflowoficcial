# Неудачные публикации по каналам

Когда оркестратор успешно публикует статью **хотя бы в одном канале** (Дзен или Telegram), тема удаляется из таблицы. Если в каком-то канале публикация не прошла, запись о такой статье попадает в файл **`storage/failed_publications.jsonl`** — по одной строке JSON на каждую статью.

## Назначение

- Не дублировать тему при следующих запусках (тема уже удалена из таблицы).
- Иметь список статей, которые можно допубликовать в канал после исправления ошибки (например, настройка Telegram-бота).

## Формат записи (одна строка = один JSON-объект)

| Поле | Описание |
|------|----------|
| `timestamp` | Время записи (ISO) |
| `title` | Заголовок статьи |
| `meta_description` | Мета-описание |
| `article_dir` | Абсолютный путь к папке статьи (например `/root/contentzavod/blocks/autopost_zen/publish/013`) |
| `article_dir_relative` | Путь относительно корня проекта |
| `article_json` | Полный путь к `article.json` |
| `cover_image` | Имя файла обложки |
| `cover_path` | Полный путь к файлу обложки |
| `failed_channels` | Список каналов, где публикация не прошла: `["telegram"]` или `["zen"]` |
| `succeeded_channels` | Список каналов, где публикация прошла |
| `run_id` | ID запуска в аналитике (если есть) |

## Запуск публикации в канал по записи

После исправления ошибки (например, настройки Telegram) можно вручную допубликовать статью:

**Telegram** (папка статьи из `article_dir` или `article_dir_relative`):

```bash
cd /root/contentzavod  # или путь к проекту
source venv/bin/activate
python -m blocks.lifehacks_to_spambot blocks/autopost_zen/publish/013
# или с указанием проекта:
python -m blocks.lifehacks_to_spambot blocks/autopost_zen/publish/013 --project flowcabinet
```

**Дзен** — через основной пайплайн автопостинга с путём к папке статьи (см. README блока `blocks/autopost_zen`).

Файл `storage/failed_publications.jsonl` можно не очищать после успешной допубликации — по нему видно историю; при необходимости старые строки можно удалять вручную.
