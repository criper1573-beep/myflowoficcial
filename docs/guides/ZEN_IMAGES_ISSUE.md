# Проблема: вставка картинок в статью Дзена

## Симптомы
- Картинки в тексте статьи не вставляются
- В логах: `Side button не найден`, `Картинка #N не вставлена`
- HTML-блоки (заголовки, списки) вставляются нормально

## Причина

Редактор Дзена (Draft.js) показывает **side button** (кнопку добавления блока) **только рядом с параграфами** — не рядом со списками (`<ul>`, `<ol>`) и не внутри списка.

Текущая структура статьи:
```
[HTML: параграф + h2 + параграф + ul] → [IMAGE] → [HTML: h2 + параграф + ul] → ...
```

После вставки HTML, заканчивающегося на `</ul>`, курсор остаётся внутри последнего элемента списка. Side button там не появляется.

**Что пробуем:**
1. Нажимаем Enter 1–3 раза, чтобы выйти из списка в новый параграф
2. Ищем side button по селекторам: `button[class*="side-button"]`, `button[class*="sideButton"]` и др.

**Почему не срабатывает:**
- Селекторы могут не совпадать с актуальным DOM Дзена (версии, A/B-тесты)
- Трёх нажатий Enter может быть мало — редактор может «застревать» в списке
- Side button может иметь другие классы/атрибуты

## Варианты решения

1. **Изменить структуру контента**: после каждого `</ul>` вставлять явный параграф `\n<p>&nbsp;</p>` или `\n<p><br></p>` перед картинкой, чтобы курсор гарантированно оказывался в параграфе.

2. **Актуальные селекторы**: в DevTools на странице редактора Дзена найти реальный селектор для side button (кнопка «+» слева от блока при фокусе в параграфе).

3. **Команда `/`**: при вводе `/` появляется меню блоков. `get_by_text("Фото")` или `get_by_text("Изображение")` ловит **тултип** (`<div data-id="tooltip" class="...tooltip">Вставить изображение</div>`), а не саму кнопку. Тултип скрыт (не visible), клик по нему не срабатывает. Нужно искать кнопку по `aria-label` или по родителю, а не по тексту тултипа.

4. **Сначала параграф, потом картинка**: вставлять HTML так, чтобы перед каждым image-блоком был пустой параграф; кликать в него, потом добавлять картинку.

5. **API Дзена**: если есть публичный API для добавления блоков в статью — использовать его вместо UI.

## Где менять код
- `blocks/autopost_zen/zen_client.py` → `_add_image_in_article()`
- Селекторы side button: ~строка 565
- Добавление `<p></p>` перед image: `create_post()` ~строка 483
