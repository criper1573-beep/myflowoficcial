<!DOCTYPE html>
<html lang="ru" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>КонтентЗавод — Аналитика пайплайна</title>
  <link rel="icon" href="/static/favicon.svg" type="image/svg+xml" />
  <link rel="shortcut icon" href="/static/favicon.svg" type="image/svg+xml" />
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <link href="/static/style.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
  <div id="app" class="container mx-auto px-3 sm:px-6 py-4 sm:py-6 max-w-6xl">
    <header class="mb-4 flex flex-wrap items-start justify-between gap-3">
      <div>
        <h1 class="text-xl sm:text-2xl font-bold text-white">КонтентЗавод</h1>
        <p class="text-gray-400 text-sm sm:text-base">Аналитика пайплайна публикаций</p>
      </div>
      <div id="project-switcher-wrap" class="project-switcher-wrap relative">
        <button type="button" id="project-trigger" class="project-trigger px-4 py-2 rounded-lg font-medium text-sm bg-gray-800/50 border border-gray-700 text-white hover:bg-gray-700 transition-colors flex items-center gap-1.5" aria-haspopup="true" aria-expanded="false" aria-label="Выбрать проект">
          <span id="project-trigger-label">FLOW</span>
          <span class="project-trigger-arrow" aria-hidden="true">▼</span>
        </button>
        <div id="project-dropdown" class="project-dropdown hidden absolute top-full right-0 mt-1 py-1 min-w-[160px] bg-gray-800 border border-gray-600 rounded-lg shadow-lg z-50">
          <button type="button" data-project="flow" class="project-option w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-gray-700 hover:text-white rounded-none first:rounded-t-lg">FLOW</button>
          <button type="button" data-project="fulfilment" class="project-option w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-gray-700 hover:text-white rounded-none last:rounded-b-lg">Фулфилмент</button>
        </div>
      </div>
    </header>

    <!-- Меню каналов продвижения -->
    <nav class="flex flex-wrap gap-2 mb-6 p-2 bg-gray-800/50 rounded-lg border border-gray-700" aria-label="Каналы продвижения">
      <a href="#" data-channel="" class="nav-channel px-4 py-2 rounded-lg font-medium text-sm transition-colors bg-blue-600 text-white">Главная</a>
      <a href="#" data-channel="telegram" class="nav-channel px-4 py-2 rounded-lg font-medium text-sm transition-colors text-gray-300 hover:bg-gray-700 hover:text-white">Телеграм канал</a>
      <a href="#" data-channel="site" class="nav-channel px-4 py-2 rounded-lg font-medium text-sm transition-colors text-gray-300 hover:bg-gray-700 hover:text-white">Сайт</a>
      <a href="#" data-channel="zen" class="nav-channel px-4 py-2 rounded-lg font-medium text-sm transition-colors text-gray-300 hover:bg-gray-700 hover:text-white">Дзен</a>
      <a href="#" data-channel="vk" class="nav-channel px-4 py-2 rounded-lg font-medium text-sm transition-colors text-gray-300 hover:bg-gray-700 hover:text-white">VK</a>
      <a href="#" data-channel="vc_ru" class="nav-channel px-4 py-2 rounded-lg font-medium text-sm transition-colors text-gray-300 hover:bg-gray-700 hover:text-white">VC.ru</a>
      <a href="#" data-channel="generation" id="nav-channel-generation" class="nav-channel px-4 py-2 rounded-lg font-medium text-sm transition-colors text-gray-300 hover:bg-gray-700 hover:text-white">Generation</a>
    </nav>

    <!-- Контент: Главная -->
    <main id="page-main" class="space-y-6">
      <section id="summary" class="grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4">
        <div class="card bg-gray-800 rounded-lg p-4 border border-gray-700">
          <div class="text-gray-400 text-xs sm:text-sm uppercase tracking-wide">Всего запусков</div>
          <div id="stat-total" class="text-2xl sm:text-3xl font-bold text-white">—</div>
        </div>
        <div class="card bg-gray-800 rounded-lg p-4 border border-gray-700">
          <div class="text-gray-400 text-xs sm:text-sm uppercase tracking-wide">Успешных</div>
          <div id="stat-completed" class="text-2xl sm:text-3xl font-bold text-green-400">—</div>
        </div>
        <div class="card bg-gray-800 rounded-lg p-4 border border-gray-700">
          <div class="text-gray-400 text-xs sm:text-sm uppercase tracking-wide">С ошибками</div>
          <div id="stat-failed" class="text-2xl sm:text-3xl font-bold text-red-400">—</div>
        </div>
        <div class="card bg-gray-800 rounded-lg p-4 border border-gray-700">
          <div class="text-gray-400 text-xs sm:text-sm uppercase tracking-wide">Сегодня</div>
          <div id="stat-today" class="text-2xl sm:text-3xl font-bold text-blue-400">—</div>
        </div>
      </section>

      <section class="flex items-center justify-between flex-wrap gap-2">
        <h2 class="text-lg font-semibold text-white">Публикации по дням</h2>
        <div class="flex gap-2">
          <button data-days="7" class="timeline-btn px-3 py-1.5 rounded bg-gray-700 text-gray-300 text-sm hover:bg-gray-600">7 дн</button>
          <button data-days="30" class="timeline-btn px-3 py-1.5 rounded bg-gray-700 text-gray-300 text-sm hover:bg-gray-600">30 дн</button>
          <button data-days="90" class="timeline-btn px-3 py-1.5 rounded bg-gray-700 text-gray-300 text-sm hover:bg-gray-600">90 дн</button>
        </div>
      </section>
      <section id="chart" class="bg-gray-800 rounded-lg p-4 border border-gray-700 min-h-[200px]">
        <div id="timeline-chart"></div>
      </section>

      <section class="main-only">
        <h2 class="text-lg font-semibold text-white mb-3">Сервисы на сервере</h2>
        <div id="services-list" class="grid gap-3 sm:grid-cols-3">
          <div id="services-loading" class="text-gray-500 col-span-full py-2">Загрузка…</div>
          <div id="services-items" class="col-span-full"></div>
        </div>
        <div id="services-more-wrap" class="mt-3 hidden">
          <button type="button" id="btn-services-more" class="px-4 py-2 rounded-lg bg-gray-700 text-gray-300 text-sm hover:bg-gray-600">Показать больше</button>
        </div>
        <p id="services-note" class="text-gray-500 text-sm mt-2 hidden" aria-live="polite"></p>
      </section>

      <section class="main-only">
        <h2 class="text-lg font-semibold text-white mb-3">Запуски</h2>
      </section>
      <section id="runs-list" class="main-only space-y-4">
        <div id="runs-loading" class="text-gray-500 py-8 text-center">Загрузка…</div>
        <div id="runs-items"></div>
        <div id="runs-more-wrap" class="hidden">
          <button type="button" id="btn-runs-more" class="px-4 py-2 rounded-lg bg-gray-700 text-gray-300 text-sm hover:bg-gray-600">Показать больше</button>
        </div>
      </section>
    </main>

    <!-- Контент: Generation (картинки и ссылки) -->
    <div id="page-generation" class="hidden space-y-6">
      <h2 class="text-lg font-semibold text-white">Статистика генераций</h2>
      <div class="flex flex-wrap gap-2 mb-4">
        <button type="button" id="gen-pill-images" class="gen-pill px-4 py-2 rounded-lg font-medium text-sm bg-blue-600 text-white">Картинки</button>
        <button type="button" id="gen-pill-links" class="gen-pill px-4 py-2 rounded-lg font-medium text-sm bg-gray-700 text-gray-300 hover:bg-gray-600">Ссылки</button>
      </div>
      <div id="gen-content-images" class="gen-content space-y-6">
        <section class="grid grid-cols-2 sm:grid-cols-4 gap-3">
          <div class="card bg-gray-800 rounded-lg p-4 border border-gray-700">
            <div class="text-gray-400 text-xs uppercase tracking-wide">Всего генераций</div>
            <div id="gen-stat-total" class="text-2xl font-bold text-white">—</div>
          </div>
        </section>
        <section>
          <h3 class="text-base font-medium text-white mb-3">По дням</h3>
          <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
            <div id="gen-chart" class="w-full" style="height: 220px;"></div>
            <p id="gen-chart-empty" class="text-gray-500 text-sm text-center py-4 hidden">Нет данных за период</p>
          </div>
        </section>
        <section>
          <h3 class="text-base font-medium text-white mb-3">Пользователи</h3>
          <div id="gen-users-list" class="space-y-2"></div>
        </section>
      </div>
      <div id="gen-content-links" class="gen-content hidden space-y-6">
        <section class="grid grid-cols-2 sm:grid-cols-4 gap-3">
          <div class="card bg-gray-800 rounded-lg p-4 border border-gray-700">
            <div class="text-gray-400 text-xs uppercase tracking-wide">Всего ссылок</div>
            <div id="gen-links-stat-total" class="text-2xl font-bold text-white">—</div>
          </div>
        </section>
        <section>
          <h3 class="text-base font-medium text-white mb-3">По дням</h3>
          <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
            <div id="gen-links-chart" class="w-full" style="height: 220px;"></div>
            <p id="gen-links-chart-empty" class="text-gray-500 text-sm text-center py-4 hidden">Нет данных за период</p>
          </div>
        </section>
        <section>
          <h3 class="text-base font-medium text-white mb-3">Пользователи</h3>
          <div id="gen-links-users-list" class="space-y-2"></div>
        </section>
      </div>
    </div>

    <!-- Контент: страница канала (сводка, воронка, график) -->
    <div id="page-channel" class="hidden space-y-6">
      <h2 id="channel-title" class="text-lg font-semibold text-white"></h2>
      <section class="channel-stats-section">
        <h3 class="text-base font-medium text-white mb-3">Статистика по каналу</h3>
        <div id="channel-summary" class="grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4"></div>
      </section>
      <section id="channel-funnel" class="bg-gray-800 rounded-lg p-4 border border-gray-700">
        <h3 class="text-base font-medium text-white mb-3">Воронка (просмотры и др.)</h3>
        <div id="channel-funnel-content" class="text-gray-400 text-sm"></div>
      </section>
      <section class="flex items-center justify-between flex-wrap gap-2">
        <h3 class="text-base font-medium text-white">Динамика просмотров по дням</h3>
        <div class="flex gap-2">
          <button data-days="7" class="channel-timeline-btn px-3 py-1.5 rounded bg-gray-700 text-gray-300 text-sm hover:bg-gray-600">7 дн</button>
          <button data-days="30" class="channel-timeline-btn px-3 py-1.5 rounded bg-gray-700 text-gray-300 text-sm hover:bg-gray-600">30 дн</button>
          <button data-days="90" class="channel-timeline-btn px-3 py-1.5 rounded bg-gray-700 text-gray-300 text-sm hover:bg-gray-600">90 дн</button>
        </div>
      </section>
      <section id="channel-chart" class="bg-gray-800 rounded-lg p-4 border border-gray-700 min-h-[200px]">
        <div id="channel-timeline-chart"></div>
      </section>
    </div>
  </div>

  <!-- Попап: генерации пользователя (картинки) -->
  <div id="gen-user-popup" class="fixed inset-0 z-50 hidden" aria-hidden="true">
    <div class="absolute inset-0 bg-black/70" data-close="gen-user-popup"></div>
    <div class="absolute inset-4 sm:inset-8 bg-gray-800 border border-gray-600 rounded-xl shadow-2xl flex flex-col overflow-hidden">
      <div class="flex justify-between items-center p-4 border-b border-gray-600">
        <h3 class="text-lg font-semibold text-white">Генерации пользователя <span id="gen-user-popup-title"></span></h3>
        <button type="button" id="gen-user-popup-close" class="p-2 text-gray-400 hover:text-white rounded" aria-label="Закрыть">✕</button>
      </div>
      <div id="gen-user-popup-list" class="flex-1 overflow-auto p-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-3"></div>
    </div>
  </div>

  <!-- Попап: ссылки пользователя -->
  <div id="gen-links-user-popup" class="fixed inset-0 z-50 hidden" aria-hidden="true">
    <div class="absolute inset-0 bg-black/70" data-close="gen-links-user-popup"></div>
    <div class="absolute inset-4 sm:inset-8 bg-gray-800 border border-gray-600 rounded-xl shadow-2xl flex flex-col overflow-hidden">
      <div class="flex justify-between items-center p-4 border-b border-gray-600">
        <h3 class="text-lg font-semibold text-white">Ссылки пользователя <span id="gen-links-user-popup-title"></span></h3>
        <button type="button" id="gen-links-user-popup-close" class="p-2 text-gray-400 hover:text-white rounded" aria-label="Закрыть">✕</button>
      </div>
      <div id="gen-links-user-popup-list" class="flex-1 overflow-auto p-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-3"></div>
    </div>
  </div>

  <!-- Попап с ошибкой (текст можно выделить и скопировать) -->
  <div id="error-panel" class="fixed inset-0 z-50 hidden" aria-hidden="true">
    <div class="absolute inset-0 bg-black/70" data-close="error-panel"></div>
    <div class="absolute bottom-0 left-0 right-0 max-h-[80vh] overflow-auto bg-gray-800 border-t border-gray-600 rounded-t-2xl shadow-2xl p-4 sm:p-6">
      <div class="flex justify-between items-start gap-2 mb-2">
        <h3 class="text-lg font-semibold text-red-400">Ошибка</h3>
        <div class="flex items-center gap-2">
          <button type="button" id="error-panel-copy" class="px-3 py-1.5 rounded bg-gray-700 text-gray-300 text-sm hover:bg-gray-600">Скопировать</button>
          <button type="button" data-close="error-panel" class="text-gray-400 hover:text-white p-1">✕</button>
        </div>
      </div>
      <div id="error-panel-label" class="text-gray-300 text-sm mb-2"></div>
      <pre id="error-panel-message" class="error-panel-message text-xs sm:text-sm text-gray-400 whitespace-pre-wrap break-words bg-gray-900 p-3 rounded overflow-x-auto select-text"></pre>
    </div>
  </div>

  <script src="/static/app.js"></script>
</body>
</html>
